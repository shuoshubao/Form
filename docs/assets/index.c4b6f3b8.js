var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,n=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,s=(e,s)=>{for(var o in s||(s={}))t.call(s,o)&&n(e,o,s[o]);if(l)for(var o of l(s))a.call(s,o)&&n(e,o,s[o]);return e},o=(e,t,l)=>(n(e,"symbol"!=typeof t?t+"":t,l),l);import{r,p as i,l as c,S as u,c as p,i as m,f as d,T as h,Q as f,a as b,s as v,I as y,b as g,d as E,e as k,g as S,h as C,D as w,B as V,j as R,R as Y,C as _,F,k as T,m as j,n as P,o as D,U as M,q as N,t as x,u as B,z as I}from"./vendor.578874f1.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(l){const a=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((l,s)=>{const o=new URL(e,a);if(self[t].moduleMap[o])return l(self[t].moduleMap[o]);const r=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){s(new Error(`Failed to import: ${e}`)),n(i)},onload(){l(self[t].moduleMap[o]),n(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("https:/shuoshubao.github.io/Search/assets/");class O extends r.Component{constructor(){super(...arguments),o(this,"onChange",((e,t)=>{c.isFunction(this.props.onChange)&&this.props.onChange(e,t)}))}render(){const{defaultValue:e,value:t,style:l}=this.props,{onChange:a}=this,n=c.omit(this.props,["defaultValue","value","onChange","style"]);return r.createElement("div",{style:l},r.createElement(u,s({checked:t,defaultChecked:e,onChange:a},n)))}}o(O,"displayName","SearchSwitch"),o(O,"defaultProps",{}),o(O,"propTypes",{value:i.bool,onChange:i.func});const W="DynaSearch",$=c.kebabCase(W),L={size:"small",bordered:!1},q={layout:"inline"},H={label:"",name:"",visible:!0,defaultValue:"",immediate:!0,tooltip:"",placeholder:"",isSearch:!1,inline:!0,style:{},formItemStyle:{},template:{tpl:"input",width:200}},U={date:"YYYY-MM-DD",year:"YYYY",month:"YYYY-MM",week:"YYYY-wo",quarter:"quarter"},A=["input","search","select-search","select-input"],z=(e="")=>[W,e].join(""),K=(...e)=>p(e).split(" ").map((e=>[$,e].join("-"))).join(" "),G=e=>{const{template:t}=e,{tpl:l,width:a}=t,n={};return["radio","checkbox","range-picker"].includes(l)?n.width=void 0:n.width=a,n},Q=/\[(.+?)\|(.+?)\]/g,J=e=>c.flatten([e]).filter(Boolean).map(String).map((e=>e.replace(/\\n/g,"<br>"))).map((e=>e.replace(Q,((...e)=>{const[,t,l]=e;return b({tagName:"a",attrs:{href:l,target:"_blank",style:{color:"#fff",fontWeight:"bold",textDecoration:"underline"}},text:t})})))).map(((e,t)=>r.createElement("div",{key:[t].join(),dangerouslySetInnerHTML:{__html:e}})));class X extends r.Component{constructor(e){super(e),o(this,"onSelectChange",(async e=>{await v(this,{selectValue:e}),this.onChange()})),o(this,"onInputChange",(async e=>{await v(this,{inputValue:e.target.value}),this.onChange()})),o(this,"onSearch",(()=>{const{props:e,state:t}=this,{onSearch:l}=e;c.isFunction(l)&&l()})),o(this,"onChange",(()=>{const{props:e,state:t}=this,{onChange:l}=e;if(!c.isFunction(l))return;const{column:a,value:n,style:s}=e,{selectValue:o,inputValue:r}=t,{name:i,inline:u,template:p}=a,{inputType:m}=p;if(!["input","search"].includes(m))return["select-search","select-input"].includes(m)?(i.split("___"),void l([o,r])):void 0;l(r)})),this.state={selectValue:null,inputValue:""}}componentDidMount(){const{props:e,state:t,onSelectChange:l,onInputChange:a}=this,{column:n,value:s,style:o}=e,{name:r,defaultValue:i,inline:c,template:u}=n,{inputType:p,options:m,selectWidth:d=100,inputWidth:h=H.template.width}=u;["select-search","select-input"].includes(p)&&(""===i&&this.setState({selectValue:m[0].value}),Array.isArray(i)&&2===i.length&&this.setState({selectValue:i[0],inputValue:i[1]}))}render(){const{props:e,state:t,onSelectChange:l,onInputChange:a,onSearch:n}=this,{column:o,defaultValue:i,value:u,style:p}=e,{selectValue:m,inputValue:d}=t,{name:h,inline:f,template:b}=o,{inputType:v,options:E,selectWidth:k=100,inputWidth:S=H.template.width}=b,C=c.omit(e,["column","defaultValue","value","onChange","onSearch","style"]);if("search"===v)return r.createElement(y.Search,s(s({},C),{defaultValue:i,value:d,onChange:a,onSearch:()=>{n()}}));if(["select-search","select-input"].includes(v)){const{label:e}=E.find((e=>e.value===m))||{};return r.createElement(y.Group,s({compact:!0},C),r.createElement(g,{value:m,onChange:l,options:E,style:{width:k}}),"select-search"===v?r.createElement(y.Search,s(s({},C),{value:d,style:{width:S},onChange:a,onSearch:()=>{n()},placeholder:["请输入",e].join("")})):r.createElement(y,{value:d,style:{width:S},onChange:a,placeholder:["请输入",e].join("")}))}return r.createElement(y,s(s({},C),{style:{width:S}}))}}o(X,"displayName",z("Input")),o(X,"defaultProps",{}),o(X,"propTypes",{value:i.any,onChange:i.func,onSearch:i.func,column:i.object});class Z extends r.Component{constructor(e){super(e),o(this,"setFields",(()=>{const{props:e,state:t}=this,{columns:l,getFieldsValue:a}=e,n=a(),s=[];c.sortBy(Object.entries(n),(([e])=>l.findIndex((t=>t.name===e)))).filter((([e,t])=>E(S(t),k(t)))).forEach((([e,t])=>{const a=c.find(l,{name:e}),{name:n,label:o,template:r}=a,{tpl:i,options:u}=r;if(["select","radio","checkbox","date-picker","range-picker"].includes(i)){if(["date-picker","range-picker"].includes(i)){const{format:e}=r;let l=d(t,e);return["range-picker"].includes(i)&&(l=[d(t[0],e),d(t[1],e)].join(" - ")),void s.push({name:n,value:t,label:o,valueText:l})}["select","radio","checkbox"].includes(i)&&c.sortBy(c.flatten([t]),(e=>u.findIndex((t=>t.value===e)))).forEach((e=>{const t=C(e,u);s.push({name:n,value:e,label:o,valueText:t})}))}})),this.setState({data:s})})),o(this,"onRemove",((e,t)=>{const{props:l,state:a}=this,{onChange:n,columns:s,getFieldsValue:o}=l,r=o(),{name:i,value:u}=e,p=c.find(s,{name:i}),{template:m}=p,{tpl:d}=m;this.setState((e=>{const l=c.cloneDeep(e.data);return l.splice(t,1),{data:l}}));let h=c.cloneDeep(r[i]);Array.isArray(h)?"range-picker"===d?h="":c.remove(h,(e=>e===u)):h="",n([{name:i,value:h}])})),this.state={data:[]}}componentDidMount(){}render(){const{props:e,state:t,onRemove:l}=this,{data:a}=t;return k(a)?null:r.createElement("div",{className:K("filter-panel")},r.createElement(w,{orientation:"left"},r.createElement("span",null,"已选"),r.createElement(V,{count:a.length,offset:[5,-3],size:"small"})),a.map(((e,t)=>{const{label:a,value:n,valueText:s}=e,o=`${a}(${s})`;return r.createElement(R,{color:"blue",closable:!0,key:[t,n].join(),onClose:()=>{l(e,t)}},o)})))}}o(Z,"displayName",z("FilterPanel")),o(Z,"defaultProps",{}),o(Z,"propTypes",{columns:i.array.isRequired,getFieldsValue:i.func.isRequired,onChange:i.func.isRequired});const{RangePicker:ee}=D;class te extends r.Component{constructor(e){super(e),this.state={columns:[],initialValues:{}},this.formRef=r.createRef(),this.filterPanelRef=r.createRef(),this.customEvents=this.getCustomEvents(),this.domEvents=this.getDomEvents(),this.renderResult=this.getRenderResult()}async componentDidMount(){const{columns:e,autoSubmit:t}=this.props,l=((e=[])=>c.cloneDeep(e).map(((e,t)=>{const l=c.merge({},H,e),{name:a,label:n,defaultValue:o}=l;let{template:r}=l;const{tpl:i}=r;if("input"===i){r=s({inputType:"input"},r);const{inputType:e}=r;if(l.placeholder=n?["请输入",n].join(""):"",["select-search","select-input"].includes(e)){r=s({options:[]},r);const[e,t]=a.split(",");l.name=[e,t].join("___")}}if("select"===i&&(l.placeholder=n?["请选择",n].join(""):"",l.defaultValue=o===H.defaultValue?void 0:o),"cascader"===i&&(l.placeholder=n?["请选择",n].join(""):"",l.defaultValue=o===H.defaultValue?[]:o),"checkbox"===i&&(l.defaultValue=o===H.defaultValue?[]:o),"date-picker"===i&&(r=s({picker:"date"},r),r=s({format:U[r.picker]},r),l.placeholder=void 0),"range-picker"===i){const[e,t]=a.split(",");l.name=[e,t].join("___"),r=s({format:"YYYY-MM-DD HH:mm:ss"},r),l.placeholder=void 0}return l.template=r,l})).filter((e=>Boolean(e.visible))))(e);((e=[])=>{e.forEach((e=>{const{name:t,label:l,defaultValue:a,template:n}=e,{tpl:s}=n;if("input"===s){const{inputType:e="input"}=n;if(!A.includes(e))throw new Error(`[${W}]inputType 参数非法, 需为其中一种: ${A.join("|")}`);if(["select-search","select-input"].includes(e)){const[e,l]=t.split("___");if(m(e,l))throw new Error(`[${W}]range-picker 必须传参数: "name" 需为长度为 "selectKey,inputKey"`)}}if("range-picker"===s){const[e,l]=t.split("___");if(m(e,l))throw new Error(`[${W}]range-picker 必须传参数: "name" 需为长度为 "startTimeKey,endTimeKey"`)}}))})(l);const a=((e=[])=>c.cloneDeep(e).reduce(((e,t)=>{const{name:l,defaultValue:a,template:n}=t,{tpl:s}=n;if("range-picker"===s){const[t,a]=l.split("___");return e[t]="",e[a]="",e}return e[l]=a,e}),{}))(l);await v(this,{columns:l,initialValues:a}),k(l)||t&&this.domEvents.onSearch()}getCustomEvents(){return{}}getDomEvents(){return{onImmediateSearch:e=>{const{immediate:t,template:l}=e,{tpl:a}=l;this.domEvents.debounceFilterPanelSetFields(),t&&(["input"].includes(a)||this.domEvents.onSearch())},onSearch:c.debounce((()=>{const{state:e,props:t}=this,{columns:l}=e,a=this.formRef.current.getFieldsValue(),n=((e,t)=>{const l={};return t.forEach((t=>{const{name:a,defaultValue:n,template:s}=t,{tpl:o}=s,r=e[a];if("input"===o){const{inputType:e}=s;if(["select-search","select-input"].includes(e)){const[e,t]=a.split("___");return l[e]=r[0],void(l[t]=r[1])}}if("date-picker"!==o)if("range-picker"!==o)l[a]=r;else{const{format:e}=s,[t,n]=a.split("___");r?(l[t]=d(r[0],e),l[n]=d(r[1],e)):(l[t]="",l[n]="")}else{const{format:e}=s;l[a]=r?d(r,e):n}})),l})(a,l);c.isFunction(t.onSubmit)&&t.onSubmit(n,a),this.domEvents.debounceFilterPanelSetFields()}),100),debounceFilterPanelSetFields:c.debounce((()=>{const{visibleFilterPanel:e}=this.props;e&&this.filterPanelRef.current.setFields()}),110),onReset:()=>{this.formRef.current.resetFields(),this.domEvents.onSearch()}}}getRenderResult(){return{renderColumns:()=>{const{props:e,state:t}=this,{columns:l}=t,a=e.labelWidth||(e=>{if(1===e.length)return 0;const t=e.map((e=>{const{label:t,tooltip:l}=e;let a=14*t.length;return l.length&&(a+=19),a}));return Math.max(...t)})(l);return l.map(((e,t)=>{const{label:l,name:n,inline:o,template:i}=e,{tpl:u}=i,p=(e=>{const{placeholder:t,template:l}=c.cloneDeep(e);return s({placeholder:t,style:G(e)},c.omit(l,["width","tpl"]))})(e);p.onChange=()=>{this.domEvents.onImmediateSearch(e)};let m=null;"input"===u&&(m=r.createElement(X,s(s({column:e},p),{onSearch:()=>{this.domEvents.onSearch()}}))),"select"===u&&(m=r.createElement(g,s({},p))),"cascader"===u&&(m=r.createElement(P,s({},p))),"radio"===u&&(m=r.createElement(Y.Group,s({},p))),"checkbox"===u&&(m=r.createElement(_.Group,s({},p))),"date-picker"===u&&(m=r.createElement(D,s({},p))),"range-picker"===u&&(m=r.createElement(ee,s({},p))),"switch"===u&&(m=r.createElement(O,s({},p)));const d=((e,{labelWidth:t})=>{const{label:l,tooltip:a}=e;return l.trim()?r.createElement("div",{style:{width:t||void 0}},r.createElement("span",null,l),!!a&&r.createElement(h,{title:J(a),overlayClassName:K("tooltip")},r.createElement(f,{style:{marginLeft:5}}))):null})(e,{labelWidth:a}),b=[t,l,n].join("_");return r.createElement(F.Item,{label:d,name:n,key:b,style:{width:o?void 0:"100%"}},m)}))},renderSearchReset:()=>{const{state:e,domEvents:t}=this,{columns:l}=e,{onReset:a}=t,{showSearchBtn:n,showResetBtn:s}=this.props;if(E(n,s))return null;let o=n,i=s;if(1===l.length){const{template:e}=l[0],{tpl:t,inputType:a}=e;"input"===t&&"input"==a&&(o=!0),i=!1}return r.createElement(F.Item,{className:K("form-item",{"form-item-hide-submit":!o,"form-item-hide-reset":!i})},r.createElement(T,{type:"primary",htmlType:"submit",key:"submit",className:K("form-item-submit")},"查询"),r.createElement(T,{onClick:a,key:"reset",className:K("form-item-reset")},"重置"))}}}render(){const{props:e,state:t,domEvents:l,renderResult:a}=this,{columns:n,initialValues:o}=t,{visibleFilterPanel:i}=e,{onSearch:u}=l;if(k(n))return null;const p=c.merge({},e.cardProps,L),m=c.merge({},e.formProps,q);return r.createElement(j,s({className:K("container")},p),r.createElement(F,s(s({ref:this.formRef},c.omit(m,["ref","onFinish","initialValues"])),{onFinish:u,initialValues:o}),a.renderColumns(),a.renderSearchReset()),i&&r.createElement(Z,{ref:this.filterPanelRef,columns:n,getFieldsValue:()=>this.formRef.current.getFieldsValue(),onChange:e=>{this.formRef.current.setFields(e),this.domEvents.onSearch()}}))}}o(te,"displayName",W),o(te,"defaultProps",{autoSubmit:!0,showSearchBtn:!1,showResetBtn:!0,cardProps:{},formProps:{},labelWidth:0,visibleFilterPanel:!1}),o(te,"propTypes",{columns:i.array.isRequired,autoSubmit:i.bool,showSearchBtn:i.bool,showResetBtn:i.bool,onSubmit:i.func,cardProps:i.object,formProps:i.object,labelWidth:i.number,visibleFilterPanel:i.bool});const le=[{label:"关键字1",name:"a1",tooltip:["这里填写姓名","a[a|https://ke.com]b"],template:{inputType:"search"}},{label:"关键字2",name:"a2",tooltip:["这里填写姓名","a[a|https://ke.com]b"],template:{inputType:"search",enterButton:"搜索"}},{label:"关键字3",name:"a3,a31",tooltip:["这里填写姓名","a[a|https://ke.com]b"],inline:!1,template:{inputType:"select-search",options:[{label:"交易编号",value:"businessCode"},{label:"合同编号",value:"contractNo"},{label:"买方",value:"buyerName"},{label:"卖方",value:"sellerName"}]}},{label:"关键字4",name:"a4,a41",tooltip:["这里填写姓名","a[a|https://ke.com]b"],inline:!1,template:{inputType:"select-search",enterButton:"搜索",options:[{label:"交易编号",value:"businessCode"},{label:"合同编号",value:"contractNo"},{label:"买方",value:"buyerName"},{label:"卖方",value:"sellerName"}]}},{label:"关键字5",name:"a5,a51",tooltip:["这里填写姓名","a[a|https://ke.com]b"],inline:!1,template:{inputType:"select-input",enterButton:"搜索",options:[{label:"交易编号",value:"businessCode"},{label:"合同编号",value:"contractNo"},{label:"买方",value:"buyerName"},{label:"卖方",value:"sellerName"}]}},{label:"姓名",name:"b",tooltip:["这里填写姓名","a[a|https://ke.com]b"]},{label:"搜索框",name:"a",template:{inputType:"search",prefix:r.createElement(M,null),enterButton:!0,allowClear:!0}},{label:"性别",name:"c",defaultValue:2,template:{tpl:"select",allowClear:!0,options:[{label:"男",value:1,disabled:!0},{label:"女",value:2}]}},{label:"创建时间1",name:"d",tooltip:"创建时间1",template:{tpl:"date-picker"}},{label:"创建时间2",name:"d1",template:{tpl:"date-picker",format:"YYYY-MM-DD HH:mm",showTime:!0}},{label:"创建时间3",name:"d2",template:{tpl:"date-picker",format:"YYYY-MM-DD HH:mm:ss",showTime:!0}},{label:"创建时间4",name:"d3",template:{tpl:"date-picker",picker:"month"}},{label:"时间区间",name:"sTime,eTime",inline:!1,template:{tpl:"range-picker",format:"YYYY-MM-DD"}},{label:"状态",name:"f",inline:!1,template:{tpl:"radio",options:[{label:"待存管",value:1},{label:"部分存管",value:2,disabled:!0},{label:"存管完成",value:3},{label:"已解冻",value:4}]}},{label:"状态",name:"g",inline:!1,template:{tpl:"checkbox",options:[{label:"待存管",value:1},{label:"部分存管",value:2,disabled:!0},{label:"存管完成",value:3},{label:"已解冻",value:4}]}},{label:"开关",name:"h",defaultValue:!0,template:{tpl:"switch"}}];var ae=()=>r.createElement("div",{className:"App",style:{padding:10,background:"#edf0f3"}},r.createElement(te,{columns:le,onSubmit:(e,t)=>{console.log("搜索:"),console.log(e)},visibleFilterPanel:!0}));N.locale("zh-cn"),x.render(r.createElement(r.StrictMode,null,r.createElement(B,{locale:I},r.createElement(ae,null))),document.getElementById("root"));
